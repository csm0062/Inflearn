<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag Events Example</title>
    <link rel="stylesheet" href="../css/_01_the_hostel.css">
    <style>
        /* body는 전체 화면에서 flexbox를 사용하여 중앙에 배치 */
        

        /* 아이템 존을 중앙 위쪽에 배치하는 컨테이너 */
        .itemzone-container {
            position: absolute;
            top: 20px;  /* 화면 위에서 20px 아래에 배치 */
            width: 100%;
            display: flex;
            justify-content: center;
            background-color: white;  /* 배경색을 핑크로 설정 */
            opacity: 50%;
            padding: 20px;  /* 패딩 20px */
            box-sizing: border-box;  /* 패딩 포함한 너비 계산 */
        }

        /* 드래그 가능한 요소 스타일 */
        .draggable {
            width: 100px;  /* 요소 너비 */
            height: 100px;  /* 요소 높이 */
            background-color: lightblue;  /* 배경 색상 */
            text-align: center;  /* 텍스트 중앙 정렬 */
            line-height: 100px;  /* 텍스트 수직 정렬 */
            margin: 20px;  /* 외부 여백 */
            cursor: grab;  /* 커서 모양 변경 */
        }

        /* 드롭 가능한 영역을 화면 중앙에 배치하는 컨테이너 */
        .dropzone-container {
            position: absolute;
            top: 50%;  /* 화면의 50% 지점에 배치 */
            left: 50%;  /* 화면의 50% 지점에 배치 */
            transform: translate(-50%, -50%);  /* 정확히 중앙에 배치되도록 조정 */
            display: flex;
            justify-content: center;
            padding: 20px;  /* 패딩 20px */
            background-color: lightgray;  /* 배경색을 라이트그레이로 설정 */
            box-sizing: border-box;  /* 패딩 포함한 너비 계산 */
            width: 800px;  /* 고정 너비 */
        }

        /* 드롭 가능한 영역 스타일 */
        .dropzone {
            width: 200px;  /* 영역 너비 */
            height: 200px;  /* 영역 높이 */
            background-color: white;  /* 배경 색상 */
            text-align: center;  /* 텍스트 중앙 정렬 */
            line-height: 200px;  /* 텍스트 수직 정렬 */
            margin: 10px;  /* 외부 여백 */
            border: 2px dashed #aaa;  /* 점선 테두리 */
            position: relative;  /* 상대적 위치 설정 */
        }
    </style>
</head>
<body>
  <div id="overlay-top"></div>
    <div id="game-container">
      
        <img id="stage-image" src="../image/images/stage/무대배경.JPG" alt="Stage" style="width: 100%; height: 100%;">
        <button id="left-button" class="nav-button" onclick="location.href='_03_right_wall.html'">&lt;</button>
        <button id="right-button" class="nav-button" onclick="location.href='_05_left_wall.html'">&gt;</button>

        <div class="itemzone-container" id="item-zone">
          <!-- 드래그 가능한 아이템들 -->
          <div id="draggable1" class="draggable" draggable="true" data-id="1">Item 1</div>
          <div id="draggable2" class="draggable" draggable="true" data-id="2">Item 2</div>
          <div id="draggable3" class="draggable" draggable="true" data-id="3">Item 3</div>
          <div id="draggable4" class="draggable" draggable="true" data-id="4">Item 4</div>
        </div>
  
        <div class="dropzone-container" id="dropzone-container">
            <!-- 드롭 가능한 영역들 -->
            <div id="dropzone1" class="dropzone" data-id="1">Zone 1</div>
            <div id="dropzone2" class="dropzone" data-id="2">Zone 2</div>
            <div id="dropzone3" class="dropzone" data-id="3">Zone 3</div>
            <div id="dropzone4" class="dropzone" data-id="4">Zone 4</div>
        </div>
        <!-- 아이템 버튼 추가 -->
        <!-- <button type="button" class="btn btn-primary-item" id="button-item" data-bs-toggle="modal" data-bs-target="#intro">💼</button> -->
        <button type="button" class="btn btn-primary-item" id="button-item" onclick="goToInventory()">💼</button>
    </div>
    <div id="overlay-bottom"></div>
    <div class="shadow-overlay"></div>

    <!-- 추가적으로 필요한 스크립트 등을 불러오기 -->

    <script src="../js/_04_stage.js"></script>
    <script src="../js/inventory.js"></script>
    

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            // 모든 드래그 가능한 요소 선택
            const draggables = document.querySelectorAll('.draggable');
            // 모든 드롭 가능한 영역 선택
            const dropzones = document.querySelectorAll('.dropzone');
            // 아이템 존 선택
            const itemZone = document.getElementById('item-zone');

            // 드래그 가능한 각 요소에 대해 이벤트 리스너 추가
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (event) => {
                    // 드래그가 시작될 때 요소의 data-id 값을 dataTransfer에 저장
                    event.dataTransfer.setData('text/plain', event.target.dataset.id);
                    event.dataTransfer.effectAllowed = 'move';  // 드래그 효과 설정
                });
            });

            // 드롭 가능한 각 영역에 대해 이벤트 리스너 추가
            dropzones.forEach(dropzone => {
                dropzone.addEventListener('dragover', (event) => {
                    event.preventDefault();  // 기본 동작 방지
                    event.dataTransfer.dropEffect = 'move';  // 드롭 효과 설정
                });

                dropzone.addEventListener('drop', (event) => {
                    event.preventDefault();  // 기본 동작 방지
                    // 드래그된 요소의 data-id 가져오기
                    const draggedId = event.dataTransfer.getData('text/plain');
                    // 드롭된 영역의 data-id 가져오기
                    const dropzoneId = event.target.dataset.id;

                    // 드래그된 요소와 드롭된 영역의 ID가 일치하는지 확인
                    if (draggedId === dropzoneId) {
                        // 일치하면 드래그된 요소를 드롭 영역에 추가
                        const draggedElement = document.querySelector(`[data-id='${draggedId}']`);
                        dropzone.appendChild(draggedElement);
                        // 드래그된 요소를 드롭 영역의 중앙에 배치
                        draggedElement.style.position = 'absolute';
                        draggedElement.style.top = '50%';
                        draggedElement.style.left = '50%';
                        draggedElement.style.transform = 'translate(-50%, -50%)';
                    } else {
                        // 일치하지 않으면 경고 메시지 표시
                        alert('여기가 아닌 것 같다...');
                    }
                });
            });

            // 아이템 존에도 드래그 가능하게 설정
            itemZone.addEventListener('dragover', (event) => {
                event.preventDefault();  // 기본 동작 방지
                event.dataTransfer.dropEffect = 'move';  // 드롭 효과 설정
            });

            itemZone.addEventListener('drop', (event) => {
                event.preventDefault();  // 기본 동작 방지
                // 드래그된 요소의 data-id 가져오기
                const draggedId = event.dataTransfer.getData('text/plain');
                // 드래그된 요소를 아이템 존으로 다시 이동
                const draggedElement = document.querySelector(`[data-id='${draggedId}']`);
                itemZone.appendChild(draggedElement);
                // 드래그된 요소의 스타일 초기화
                draggedElement.style.position = 'relative';
                draggedElement.style.top = 'auto';
                draggedElement.style.left = 'auto';
                draggedElement.style.transform = 'none';
            });
        });
    </script>
</body>
</html>
