<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag Events Example</title>
    <link rel="stylesheet" href="../css/01_the_hostel.css">
    <link rel="icon" href="../image/favicon.ico" type="image/x-icon">
    <style>
        /* ì•„ì´í…œ ì¡´ì„ ì¤‘ì•™ ìœ„ìª½ì— ë°°ì¹˜í•˜ëŠ” ì»¨í…Œì´ë„ˆ */
        .itemzone-container {
            position: absolute;
            top: 20px;  /* í™”ë©´ ìœ„ì—ì„œ 20px ì•„ë˜ì— ë°°ì¹˜ */
            margin: auto;
            width: 100%;
            display: flex;
            justify-content: center;
            opacity: 100%;
            padding: 20px;  /* íŒ¨ë”© 20px */
            box-sizing: border-box;  /* íŒ¨ë”© í¬í•¨í•œ ë„ˆë¹„ ê³„ì‚° */
        }

        /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .draggable {
            width: 100px;  /* ìš”ì†Œ ë„ˆë¹„ */
            height: 100px;  /* ìš”ì†Œ ë†’ì´ */
            text-align: center;  /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            line-height: 100px;  /* í…ìŠ¤íŠ¸ ìˆ˜ì§ ì •ë ¬ */
            cursor: grab;  /* ì»¤ì„œ ëª¨ì–‘ ë³€ê²½ */
            position: relative !important;
            transform: none !important;
            top: 0 !important;
            left: 0 !important;
            border: 1px solid black;
        }

        /* ë“œë¡­ ê°€ëŠ¥í•œ ì˜ì—­ì„ í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜í•˜ëŠ” ì»¨í…Œì´ë„ˆ */
        .dropzone-container {
            position: absolute;
            top: 50%;  /* í™”ë©´ì˜ 50% ì§€ì ì— ë°°ì¹˜ */
            left: 50%;  /* í™”ë©´ì˜ 50% ì§€ì ì— ë°°ì¹˜ */
            transform: translate(-50%, -50%);  /* ì •í™•íˆ ì¤‘ì•™ì— ë°°ì¹˜ë˜ë„ë¡ ì¡°ì • */
            display: flex;
            justify-content: center;
            box-sizing: border-box;  /* íŒ¨ë”© í¬í•¨í•œ ë„ˆë¹„ ê³„ì‚° */
            width: 700px;  /* ê³ ì • ë„ˆë¹„ */
        }

        /* ë“œë¡­ ê°€ëŠ¥í•œ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .dropzone {
            width: 100px;  /* ì˜ì—­ ë„ˆë¹„ */
            height: 100px;  /* ì˜ì—­ ë†’ì´ */
            background-color: none;  /* ë°°ê²½ ìƒ‰ìƒ */
            text-align: center;  /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            line-height: 200px;  /* í…ìŠ¤íŠ¸ ìˆ˜ì§ ì •ë ¬ */
            margin: 10px;  /* ì™¸ë¶€ ì—¬ë°± */
            border: 2px dashed #aaa;  /* ì ì„  í…Œë‘ë¦¬ */
            position: relative;  /* ìƒëŒ€ì  ìœ„ì¹˜ ì„¤ì • */
            display: flex;
            justify-content: center;
            align-items: center;
            background-size: cover;
        }

        /* ìˆ¨ê¸°ê¸° ìœ„í•œ í´ë˜ìŠ¤ */
        .hidden {
            display: none;
        }

        /* í¸ì§€ë´‰íˆ¬ ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜í•˜ëŠ” ìŠ¤íƒ€ì¼ */
        #envelope-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;  /* ë§¨ ìœ„ì— ë°°ì¹˜ */
            display: none;  /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }
    </style>
</head>
<body>
  <div id="overlay-top"></div>
    <div id="game-container">
        <img id="stage-image" src="../image/images/stage/ë¬´ëŒ€ë°°ê²½.JPG" alt="Stage" style="width: 100%; height: 100%;">
        <button id="left-button" class="nav-button" onclick="location.href='03_right_wall.html'">&lt;</button>
        <button id="right-button" class="nav-button" onclick="location.href='05_left_wall.html'">&gt;</button>

        <div class="itemzone-container" id="item-zone">
            <!-- ë“œë˜ê·¸ ê°€ëŠ¥í•œ ì•„ì´í…œë“¤ -->
            <div id="draggable1" class="draggable" draggable="true" data-id="1">Item 1</div>
            <div id="draggable2" class="draggable" draggable="true" data-id="2">Item 2</div>
            <div id="draggable3" class="draggable" draggable="true" data-id="3">Item 3</div>
            <div id="draggable4" class="draggable" draggable="true" data-id="4">Item 4</div>
        </div>

        <div class="dropzone-container" id="dropzone-container">
            <!-- ë“œë¡­ ê°€ëŠ¥í•œ ì˜ì—­ë“¤ -->
            <div id="dropzone1" class="dropzone" data-id="4"></div>
            <div id="dropzone2" class="dropzone" data-id="3"></div>
            <div id="dropzone3" class="dropzone" data-id="1"></div>
            <div id="dropzone4" class="dropzone" data-id="2"></div>
        </div>

        <!-- ì•„ì´í…œ ë²„íŠ¼ ì¶”ê°€ -->
        <button type="button" class="btn btn-primary-item" id="button-item" onclick="goToInventory()">ğŸ’¼</button>
    </div>
    <div id="overlay-bottom"></div>
    <div class="shadow-overlay"></div>

    <!-- í¸ì§€ë´‰íˆ¬ ì´ë¯¸ì§€ -->
    <img id="envelope-image" src="../image/images/stage/ì—´ë¦¬í¸ì§€ë´‰íˆ¬.PNG" alt="Envelope" />

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const draggables = document.querySelectorAll('.draggable');
            const dropzones = document.querySelectorAll('.dropzone');
            const itemZone = document.getElementById('item-zone');
            const stageImage = document.getElementById('stage-image');
            const envelopeImage = document.getElementById('envelope-image');
            let droppedItems = 0;

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (event) => {
                    event.dataTransfer.setData('text/plain', event.target.dataset.id);
                    event.dataTransfer.effectAllowed = 'move';  // ë“œë˜ê·¸ íš¨ê³¼ ì„¤ì •
                });
            });

            dropzones.forEach(dropzone => {
                dropzone.addEventListener('dragover', (event) => {
                    event.preventDefault();  // ê¸°ë³¸ ë™ì‘ ë°©ì§€
                    event.dataTransfer.dropEffect = 'move';  // ë“œë¡­ íš¨ê³¼ ì„¤ì •
                });

                dropzone.addEventListener('drop', (event) => {
                    event.preventDefault();  // ê¸°ë³¸ ë™ì‘ ë°©ì§€
                    const draggedId = event.dataTransfer.getData('text/plain');
                    const dropzoneId = event.target.dataset.id;

                    if (draggedId === dropzoneId) {
                        const draggedElement = document.querySelector(`[data-id='${draggedId}']`);
                        dropzone.appendChild(draggedElement);
                        draggedElement.style.position = 'absolute';
                        draggedElement.style.top = '50%';
                        draggedElement.style.left = '50%';
                        draggedElement.style.transform = 'translate(-50%, -50%)';
                        droppedItems++;
                        checkAllItemsDropped();
                    } else {
                        alert('ì—¬ê¸°ê°€ ì•„ë‹Œ ê²ƒ ê°™ë‹¤...');
                    }
                });
            });

            itemZone.addEventListener('dragover', (event) => {
                event.preventDefault();
                event.dataTransfer.dropEffect = 'move';
            });

            itemZone.addEventListener('drop', (event) => {
                event.preventDefault();
                const draggedId = event.dataTransfer.getData('text/plain');
                const draggedElement = document.querySelector(`[data-id='${draggedId}']`);
                itemZone.appendChild(draggedElement);
                draggedElement.style.position = 'relative';
                draggedElement.style.top = 'auto';
                draggedElement.style.left = 'auto';
                draggedElement.style.transform = 'none';
            });

            const inventory = JSON.parse(localStorage.getItem("inventory"));
            let idx = 1;

            inventory.forEach((ele) => {
                if(ele.includes("ì‹¬ì¥") || ele.includes("ë°˜ì§€") || ele.includes("ê¹¨ì§„ì•¡ì") || ele.includes("ìŸë¯¸")) {
                    document.querySelector(`#draggable${idx}`).textContent = '';
                    document.querySelector(`#draggable${idx}`).style.background = `url(${ele})`;
                    document.querySelector(`#draggable${idx}`).style.backgroundColor = `white`;
                    document.querySelector(`#draggable${idx}`).style.backgroundSize = 'contain';
                    document.querySelector(`#draggable${idx}`).style.backgroundRepeat = 'no-repeat';
                    document.querySelector(`#draggable${idx}`).style.backgroundPosition = 'center center';
                    idx++;
                }
            });

            function checkAllItemsDropped() {
                if (droppedItems === 4) {
                    // ëª¨ë“  ì•„ì´í…œì´ ë“œë¡­ì¡´ì— ì˜¬ë°”ë¥´ê²Œ ë°°ì¹˜ëœ ê²½ìš°
                    stageImage.classList.add('hidden'); // ë¬´ëŒ€ ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸°
                    itemZone.classList.add('hidden'); // ì•„ì´í…œ ì¡´ ìˆ¨ê¸°ê¸°
                    dropzones.forEach(dropzone => dropzone.classList.add('hidden')); // ë“œë¡­ì¡´ ìˆ¨ê¸°ê¸°
                    envelopeImage.style.display = 'block'; // í¸ì§€ë´‰íˆ¬ ì´ë¯¸ì§€ ë³´ì´ê¸°

                    // ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ í¬ê·€ ë™ì „ ì¶”ê°€ ì „ì— ì¸ë²¤í† ë¦¬ í™•ì¸
                    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
                    if (!inventory.includes('../image/images/useritem/ë™ì „.png')) {
                        setTimeout(() => {
                            alert('í¬ê·€ ë™ì „ì„ ì–»ì—ˆë‹¤.');
                            inventory.push('../image/images/useritem/ë™ì „.png');
                            localStorage.setItem('inventory', JSON.stringify(inventory));
                            location.href = '05_left_wall.html';
                        }, 2000);
                    } else {
                        setTimeout(() => {
                            alert('í¬ê·€ ë™ì „ì´ ì´ë¯¸ ì¸ë²¤í† ë¦¬ì— ìˆìŠµë‹ˆë‹¤.');
                            location.href = '05_left_wall.html';
                        }, 2000);
                    }
                }
            }
        });

        function goToInventory() {
            window.location.href = "../HTML/inventory.html";
        }
    </script>
    <!-- <script src="inventory.js"></script> -->
</body>
</html>
